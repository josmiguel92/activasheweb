---
import { getCollection } from "astro:content";

import Layout from "@/layouts/Layout.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import PostCard from "@/components/PostCard.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import BlurCircle from "@/components/shared/BlurCircle.astro";
import Link from "@/components/shared/Link.astro";
import convertAsteriskToStrongTag from "@/utils/convertAsteriskToStrongTag";

import presentation from "@/data/presentation";
const projectsCollection = await getCollection("projects");
const projects = projectsCollection.map((p) => ({
  title: p.data.title,
  areas: p.data.areas,
  link: `/projects/${p.slug}`,
  isComingSoon: !!p.data.isComingSoon,
  image: p.data.image,
}));

const posts = await getCollection("posts");
const artItems = (await getCollection("art")).slice(0, 3);
---

<Layout noTopMargin>
  <section class="relative">
    <div class="h-[60vh] w-screen relative overflow-hidden rounded-b-3xl">
      <img 
        alt="Comunidad Activ@Ase" 
        class="w-full h-full object-cover" 
        src="/favicon.png"
      />
      <div class="absolute inset-0 image-overlay"></div>
    </div>
    <div class="-mt-32 relative z-10 max-w-4xl mx-auto px-6">
      <div class="bg-terracotta p-8 rounded-3xl card-shadow">
        <h1 class="text-4xl leading-tight mb-4 text-warm-cream">
          {presentation.title}
        </h1>
        <p class="text-lg leading-relaxed text-warm-cream opacity-95 mb-8" set:html={convertAsteriskToStrongTag(presentation.description)} />
        <div class="flex flex-col gap-3 sm:flex-row">
          <Link href="/projects" label="Conoce nuestra labor" isUnderline={false} target="_self" class="bg-mustard text-chocolate py-4 px-6 rounded-xl font-bold text-base flex items-center justify-center gap-2 hover:opacity-90" />
          <Link href="/posts" label="Lee nuestras publicaciones" isUnderline={false} target="_self" class="border-2 border-warm-cream text-warm-cream py-4 px-6 rounded-xl font-bold text-base flex items-center justify-center gap-2 hover:bg-warm-cream/10" />
        </div>
      </div>
    </div>
  </section>

  <section class="px-6 grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-4xl mx-auto">
    <div class="bg-white/5 p-6 rounded-2xl border-l-4 border-vibrant-orange">
      <span class="material-symbols-outlined text-vibrant-orange mb-3 text-3xl">restaurant</span>
      <h3 class="text-lg mb-1 text-warm-cream font-bold">Seguridad</h3>
      <p class="text-xs opacity-70">SoberanÃ­a alimentaria para nuestras familias.</p>
    </div>
    <div class="bg-white/5 p-6 rounded-2xl border-l-4 border-mustard">
      <span class="material-symbols-outlined text-mustard mb-3 text-3xl">balance</span>
      <h3 class="text-lg mb-1 text-warm-cream font-bold">Justicia</h3>
      <p class="text-xs opacity-70">Combatiendo la desigualdad sistÃ©mica.</p>
    </div>
  </section>

  <section class="px-6 space-y-6 max-w-4xl mx-auto">
    <div class="flex items-end justify-between">
      <h2 class="text-3xl font-display">Voces de la<br/><span class="text-vibrant-orange">Comunidad</span></h2>
      <Link href="/posts" label="Ver todas" isUnderline target="_self" class="text-xs font-bold text-mustard uppercase tracking-widest border-b border-mustard pb-1" />
    </div>
    {posts.length === 0 && <p>Pronto, mantente conectado ðŸ‘€...</p>}
    <div class="space-y-6">
      {
        posts.length !== 0 &&
          posts
            .slice(0, 2)
            .map((post) => (
              <PostCard
                publishedAt={post.data.publishedAt}
                title={post.data.title}
                description={post.data.description}
                slug={post.slug}
                image={post.data.image}
              />
            ))
      }
    </div>
  </section>

  <section class="px-6 space-y-6 max-w-4xl mx-auto">
    <div class="flex items-center gap-3">
      <h2 class="text-3xl font-display">Proyectos</h2>
      <span class="bg-vibrant-orange text-chocolate px-3 py-1 rounded-full text-xs font-black">ACTIVOS</span>
    </div>
    {projects.length === 0 && <p>Oops, debemos trabajar en esto...</p>}
    <div class="overflow-x-auto flex gap-6 no-scrollbar -mx-6 px-6">
      {projects.length !== 0 && projects.map((project) => <ProjectCard {...project} />)}
    </div>
  </section>

  <section class="px-6 space-y-4 max-w-4xl mx-auto">
    <div class="flex items-end justify-between">
      <h2 class="text-3xl font-display">GalerÃ­a</h2>
      <Link href="/gallery" label="Ver galerÃ­a" isUnderline target="_self" class="text-xs font-bold text-mustard uppercase tracking-widest border-b border-mustard pb-1" />
    </div>
    {artItems.length === 0 && <p class="text-sm text-warm-cream/70">Pronto compartiremos nuestras piezas mÃ¡s recientes.</p>}
    {artItems.length > 0 && (
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        {artItems.map((item) => (
          <a href="/gallery" class="group block overflow-hidden rounded-2xl border border-white/10 bg-white/5 card-shadow hover:border-mustard/60 transition-colors">
            <div class="aspect-[4/3] overflow-hidden">
              <img src={item.data.image} alt={item.data.title} class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" />
            </div>
            <div class="p-3 space-y-1">
              <p class="text-sm font-semibold text-warm-cream line-clamp-1">{item.data.title}</p>
              <p class="text-xs text-warm-cream/60 line-clamp-1">{item.data.artist}</p>
            </div>
          </a>
        ))}
      </div>
    )}
  </section>

  <section class="px-6 max-w-4xl mx-auto">
    <footer class="p-8 rounded-[2.5rem] bg-terracotta text-warm-cream">
      <h2 class="text-3xl font-display mb-4">Hablemos</h2>
      <p class="opacity-90 mb-8 leading-relaxed">
        Estamos construyendo futuro juntas. EscrÃ­benos para colaborar, donar o simplemente para conectar.
      </p>
      <div class="space-y-4 mb-10">
        <Link
        href={`mailto:${presentation.mail}`}
        label={presentation.mail}
        class="flex items-center gap-4 text-lg font-bold"
      />
      <SocialLinks />
    </div>
    <div class="pt-8 border-t border-warm-cream/20 text-center">
      <p class="text-[10px] font-black uppercase tracking-widest opacity-60">Â© 2024 Activ@Ase â€” Hecho con amor y resistencia</p>
    </div>
    </footer>
  </section>
</Layout>
