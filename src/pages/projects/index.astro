---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import ProjectCard from "@/components/ProjectCard.astro";

const projects = (await getCollection("projects")).sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime(),
);
const formatAreas = (values = []) => values.join(" â€¢ ");

const makePreview = (text = "", maxWords = 30) => {
  const words = text.split(/\s+/).filter(Boolean);
  if (words.length <= maxWords) return text;
  return words.slice(0, maxWords).join(" ") + "...";
};
---

<Layout title="Todos los Proyectos">
  <section class="mx-auto max-w-4xl space-y-8 px-6 lg:max-w-6xl">
    <div class="flex items-center gap-3">
      <h1 class="font-display text-4xl text-chocolate">
        Nuestros <span class="text-olive">Proyectos</span>
      </h1>
      <span
        class="rounded-full bg-mustard px-3 py-1 text-xs font-black text-chocolate"
        >ACTIVOS</span
      >
    </div>
    <a
      href="/"
      class="inline-block border-b border-mustard pb-1 text-xs font-bold uppercase tracking-widest text-mustard transition-colors hover:text-vibrant-orange"
      >Volver al inicio</a
    >

    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      {
        projects.map((project) => {
          const raw = project.data.description ?? "";
          const preview = makePreview(raw, 30);
          return (
            <ProjectCard
              title={project.data.title}
              areas={project.data.areas}
              link={`/projects/${project.slug}`}
              isComingSoon={!!project.data.isComingSoon}
              preview={preview}
              image={project.data.image}
            />
          );
        })
      }
    </div>
  </section>
</Layout>
