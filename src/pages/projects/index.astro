---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import formatDate from "@/utils/formatDate";
import ProjectCard from "@/components/ProjectCard.astro";

const projects = await getCollection("projects");
const formatAreas = (values = []) => values.join(" â€¢ ");

const makePreview = (text = '', maxWords = 30) => {
  const words = text.split(/\s+/).filter(Boolean);
  if (words.length <= maxWords) return text;
  return words.slice(0, maxWords).join(' ') + '...';
}
---

<Layout title="Todos los Proyectos">
  <main class="flex flex-col gap-20">
    <h1 class="text-2xl text-neutral-100">Proyectos</h1>

    <article class="flex flex-col gap-4">
      {
        projects.map((project) => {
          const raw = project.data.description ?? "";
          const preview = makePreview(raw, 30);
          return (
            <ProjectCard
              title={project.data.title}
              areas={project.data.areas}
              link={`/projects/${project.slug}`}
              isComingSoon={!!project.data.isComingSoon}
              preview={preview}
            />
          );
        })
      }
    </article>
  </main>
</Layout>
