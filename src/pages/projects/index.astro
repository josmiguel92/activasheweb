---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import formatDate from "@/utils/formatDate";
import ProjectCard from "@/components/ProjectCard.astro";

const projects = (await getCollection("projects")).sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime()
);
const formatAreas = (values = []) => values.join(" â€¢ ");

const makePreview = (text = '', maxWords = 30) => {
  const words = text.split(/\s+/).filter(Boolean);
  if (words.length <= maxWords) return text;
  return words.slice(0, maxWords).join(' ') + '...';
}
---

<Layout title="Todos los Proyectos">
  <section class="px-6 space-y-8 max-w-4xl lg:max-w-6xl mx-auto">
    <div class="flex items-center gap-3">
      <h1 class="text-4xl font-display text-chocolate">Nuestros <span class="text-olive">Proyectos</span></h1>
      <span class="bg-mustard text-chocolate px-3 py-1 rounded-full text-xs font-black">ACTIVOS</span>
    </div>
    <a href="/" class="inline-block text-xs font-bold text-mustard uppercase tracking-widest border-b border-mustard pb-1 hover:text-vibrant-orange transition-colors">Volver al inicio</a>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {
        projects.map((project) => {
          const raw = project.data.description ?? "";
          const preview = makePreview(raw, 30);
          return (
            <ProjectCard
              title={project.data.title}
              areas={project.data.areas}
              link={`/projects/${project.slug}`}
              isComingSoon={!!project.data.isComingSoon}
              preview={preview}
              image={project.data.image}
            />
          );
        })
      }
    </div>
  </section>
</Layout>
